2025-09-20 00:07:25 INFO  n.m.c.p.PurchaseManagementApplicationTests - Starting PurchaseManagementApplicationTests using Java 21.0.8 with PID 26069 (started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-20 00:07:25 DEBUG n.m.c.p.PurchaseManagementApplicationTests - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-20 00:07:25 INFO  n.m.c.p.PurchaseManagementApplicationTests - No active profile set, falling back to 1 default profile: "default"
2025-09-20 00:07:29 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-20 00:07:29 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 233 ms. Found 2 JPA repository interfaces.
2025-09-20 00:07:29 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-20 00:07:29 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-20 00:07:30 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=a17a4e36-eff8-3144-b6e6-a641da6f2652
2025-09-20 00:07:31 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-20 00:07:31 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-20 00:07:32 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-20 00:07:32 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-20 00:07:32 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-20 00:07:33 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-20 00:07:33 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-20 00:07:33 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-20 00:07:34 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-20 00:07:35 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-20 00:07:35 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id varchar(255) not null, currency_id bigint not null, primary key (id))
2025-09-20 00:07:35 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-20 00:07:35 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-20 00:07:35 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-20 00:07:35 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-20 00:07:37 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-20 00:07:39 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-20 00:07:39 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-20 00:07:42 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-20 00:07:43 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-20 00:07:43 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-20 00:07:43 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-20 00:07:43 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-20 00:07:43 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-20 00:07:43 INFO  n.m.c.p.PurchaseManagementApplicationTests - Started PurchaseManagementApplicationTests in 18.899 seconds (process running for 22.155)
2025-09-20 00:07:44 INFO  n.m.c.p.mock.CurrencyInitializer - Checking if default currency USD exists and creating it...
2025-09-20 00:07:44 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-20 00:07:44 DEBUG org.hibernate.SQL - insert into currency_tb (code,country,name,id) values (?,?,?,default)
2025-09-20 00:07:44 INFO  n.m.c.p.mock.CurrencyInitializer - Currency USD is ready to use.
2025-09-20 00:07:45 INFO  o.s.b.t.c.SpringBootTestContextBootstrapper - Found @SpringBootConfiguration net.mycompany.commerce.purchase.PurchaseManagementApplication for test class net.mycompany.commerce.purchase.mock.ProducerMockTest
2025-09-20 00:07:45 INFO  n.m.c.purchase.mock.ProducerMockTest - Starting ProducerMockTest using Java 21.0.8 with PID 26069 (started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-20 00:07:45 DEBUG n.m.c.purchase.mock.ProducerMockTest - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-20 00:07:45 INFO  n.m.c.purchase.mock.ProducerMockTest - No active profile set, falling back to 1 default profile: "default"
2025-09-20 00:07:47 WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 89d0e789-2d15-4c64-93d0-bcd810aa8068

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-09-20 00:07:47 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-09-20 00:07:47 DEBUG n.m.c.p.errorhandler.TraceIdFilter - Filter 'traceIdFilter' configured for use
2025-09-20 00:07:47 INFO  o.s.b.t.m.w.SpringBootMockServletContext - Initializing Spring TestDispatcherServlet ''
2025-09-20 00:07:47 INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-09-20 00:07:47 INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 7 ms
2025-09-20 00:07:47 INFO  n.m.c.purchase.mock.ProducerMockTest - Started ProducerMockTest in 2.065 seconds (process running for 25.997)
2025-09-20 00:07:48 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Processando compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@c8f756e
2025-09-20 00:07:48 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Criando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@c8f756e
2025-09-20 00:07:48 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Armazenando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@91cdfb7
2025-09-20 00:07:49 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@12bc9995
2025-09-20 00:07:49 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-20 00:07:49 DEBUG n.m.c.purchase.store.domain.Purchase - Salvando transação de compra
2025-09-20 00:07:49 DEBUG n.m.c.purchase.store.domain.Purchase - Transação de compra salva com sucesso: net.mycompany.commerce.purchase.model.PurchaseTransaction@20a0eb1d
2025-09-20 00:07:49 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@1b5b656b
2025-09-20 00:07:49 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-20 00:07:49 ERROR n.m.c.purchase.store.domain.Purchase - Moeda não encontrada no sistema: USD
2025-09-20 00:08:19 INFO  o.s.c.s.DefaultLifecycleProcessor - Shutdown phase 1073741823 ends with 1 bean still running after timeout of 30000ms: [applicationTaskExecutor]
2025-09-20 00:08:19 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-20 00:08:19 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-20 00:08:19 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-20 00:08:19 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-20 00:08:19 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-20 00:08:19 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-20 00:15:41 INFO  n.m.c.purchase.mock.ProducerMockTest - Starting ProducerMockTest using Java 21.0.8 with PID 26811 (started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-20 00:15:41 DEBUG n.m.c.purchase.mock.ProducerMockTest - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-20 00:15:41 INFO  n.m.c.purchase.mock.ProducerMockTest - No active profile set, falling back to 1 default profile: "default"
2025-09-20 00:15:45 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-20 00:15:46 DEBUG n.m.c.p.errorhandler.TraceIdFilter - Filter 'traceIdFilter' configured for use
2025-09-20 00:15:46 INFO  o.s.b.t.m.w.SpringBootMockServletContext - Initializing Spring TestDispatcherServlet ''
2025-09-20 00:15:46 INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-09-20 00:15:46 INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 2 ms
2025-09-20 00:15:46 INFO  n.m.c.purchase.mock.ProducerMockTest - Started ProducerMockTest in 6.538 seconds (process running for 9.398)
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Received purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@21c5c68a
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Enqueued purchase with transactionId: tx-789
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Checking response for transactionId: tx-789
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-789: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@6719f206
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-789 is ready
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Checking response for transactionId: tx-000
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-000: null
2025-09-20 00:15:47 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-000 is still processing
2025-09-20 00:15:47 INFO  o.s.t.c.s.AnnotationConfigContextLoaderUtils - Could not detect default configuration classes for test class [net.mycompany.commerce.purchase.PurchaseManagementApplicationTests]: PurchaseManagementApplicationTests does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2025-09-20 00:15:47 INFO  o.s.b.t.c.SpringBootTestContextBootstrapper - Found @SpringBootConfiguration net.mycompany.commerce.purchase.PurchaseManagementApplication for test class net.mycompany.commerce.purchase.PurchaseManagementApplicationTests
2025-09-20 00:15:47 INFO  n.m.c.p.PurchaseManagementApplicationTests - Starting PurchaseManagementApplicationTests using Java 21.0.8 with PID 26811 (started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-20 00:15:47 DEBUG n.m.c.p.PurchaseManagementApplicationTests - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-20 00:15:47 INFO  n.m.c.p.PurchaseManagementApplicationTests - No active profile set, falling back to 1 default profile: "default"
2025-09-20 00:15:49 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-20 00:15:49 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 119 ms. Found 2 JPA repository interfaces.
2025-09-20 00:15:50 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-20 00:15:50 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-20 00:15:50 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=a17a4e36-eff8-3144-b6e6-a641da6f2652
2025-09-20 00:15:51 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-20 00:15:52 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-20 00:15:52 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-20 00:15:52 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-20 00:15:52 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-20 00:15:52 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-20 00:15:52 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-20 00:15:52 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-20 00:15:54 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-20 00:15:54 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-20 00:15:54 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id varchar(255) not null, currency_id bigint not null, primary key (id))
2025-09-20 00:15:54 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-20 00:15:54 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-20 00:15:54 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-20 00:15:54 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-20 00:15:56 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-20 00:15:58 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-20 00:15:58 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-20 00:16:00 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-20 00:16:01 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-20 00:16:01 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-20 00:16:01 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-20 00:16:01 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-20 00:16:01 INFO  n.m.c.p.PurchaseManagementApplicationTests - Started PurchaseManagementApplicationTests in 13.776 seconds (process running for 24.049)
2025-09-20 00:16:01 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-20 00:16:01 INFO  n.m.c.p.mock.CurrencyInitializer - Checking if default currency USD exists and creating it...
2025-09-20 00:16:02 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-20 00:16:02 DEBUG org.hibernate.SQL - insert into currency_tb (code,country,name,id) values (?,?,?,default)
2025-09-20 00:16:02 INFO  n.m.c.p.mock.CurrencyInitializer - Currency USD is ready to use.
2025-09-20 00:16:02 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Processando compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@4cfc4c3a
2025-09-20 00:16:02 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Criando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@4cfc4c3a
2025-09-20 00:16:02 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Armazenando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@cc226b0
2025-09-20 00:16:03 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@e2a0e91
2025-09-20 00:16:03 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-20 00:16:03 DEBUG n.m.c.purchase.store.domain.Purchase - Salvando transação de compra
2025-09-20 00:16:03 DEBUG n.m.c.purchase.store.domain.Purchase - Transação de compra salva com sucesso: net.mycompany.commerce.purchase.model.PurchaseTransaction@e39a6c2
2025-09-20 00:16:03 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@36f7672d
2025-09-20 00:16:03 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-20 00:16:03 ERROR n.m.c.purchase.store.domain.Purchase - Moeda não encontrada no sistema: USD
2025-09-20 00:16:33 INFO  o.s.c.s.DefaultLifecycleProcessor - Shutdown phase 1073741823 ends with 1 bean still running after timeout of 30000ms: [applicationTaskExecutor]
2025-09-20 00:16:33 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-20 00:16:33 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-20 00:16:33 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-20 00:16:33 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-20 00:16:33 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-20 00:16:33 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-20 00:21:28 INFO  n.m.c.purchase.mock.ProducerMockTest - Starting ProducerMockTest using Java 21.0.8 with PID 27396 (started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-20 00:21:28 DEBUG n.m.c.purchase.mock.ProducerMockTest - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-20 00:21:28 INFO  n.m.c.purchase.mock.ProducerMockTest - No active profile set, falling back to 1 default profile: "default"
2025-09-20 00:21:32 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-20 00:21:33 DEBUG n.m.c.p.exception.TraceIdFilter - Filter 'traceIdFilter' configured for use
2025-09-20 00:21:33 INFO  o.s.b.t.m.w.SpringBootMockServletContext - Initializing Spring TestDispatcherServlet ''
2025-09-20 00:21:33 INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-09-20 00:21:33 INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 4 ms
2025-09-20 00:21:33 INFO  n.m.c.purchase.mock.ProducerMockTest - Started ProducerMockTest in 5.709 seconds (process running for 8.579)
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Received purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@40fcaae7
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Enqueued purchase with transactionId: tx-789
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Checking response for transactionId: tx-789
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-789: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@2e7517aa
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-789 is ready
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Checking response for transactionId: tx-000
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-000: null
2025-09-20 00:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId tx-000 is still processing
2025-09-20 00:21:34 INFO  o.s.t.c.s.AnnotationConfigContextLoaderUtils - Could not detect default configuration classes for test class [net.mycompany.commerce.purchase.PurchaseManagementApplicationTests]: PurchaseManagementApplicationTests does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2025-09-20 00:21:34 INFO  o.s.b.t.c.SpringBootTestContextBootstrapper - Found @SpringBootConfiguration net.mycompany.commerce.purchase.PurchaseManagementApplication for test class net.mycompany.commerce.purchase.PurchaseManagementApplicationTests
2025-09-20 00:21:34 INFO  n.m.c.p.PurchaseManagementApplicationTests - Starting PurchaseManagementApplicationTests using Java 21.0.8 with PID 27396 (started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-20 00:21:34 DEBUG n.m.c.p.PurchaseManagementApplicationTests - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-20 00:21:34 INFO  n.m.c.p.PurchaseManagementApplicationTests - No active profile set, falling back to 1 default profile: "default"
2025-09-20 00:21:36 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-20 00:21:36 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 92 ms. Found 2 JPA repository interfaces.
2025-09-20 00:21:36 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-20 00:21:36 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-20 00:21:37 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=a17a4e36-eff8-3144-b6e6-a641da6f2652
2025-09-20 00:21:38 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-20 00:21:39 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-20 00:21:39 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-20 00:21:39 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-20 00:21:39 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-20 00:21:39 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-20 00:21:39 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-20 00:21:39 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-20 00:21:41 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-20 00:21:41 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-20 00:21:41 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id varchar(255) not null, currency_id bigint not null, primary key (id))
2025-09-20 00:21:41 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-20 00:21:41 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-20 00:21:41 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-20 00:21:41 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-20 00:21:43 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-20 00:21:45 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-20 00:21:45 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-20 00:21:47 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-20 00:21:48 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-20 00:21:48 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-20 00:21:48 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-20 00:21:49 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-20 00:21:49 INFO  n.m.c.p.PurchaseManagementApplicationTests - Started PurchaseManagementApplicationTests in 14.944 seconds (process running for 24.216)
2025-09-20 00:21:49 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-20 00:21:49 INFO  n.m.c.p.mock.CurrencyInitializer - Checking if default currency USD exists and creating it...
2025-09-20 00:21:49 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-20 00:21:49 DEBUG org.hibernate.SQL - insert into currency_tb (code,country,name,id) values (?,?,?,default)
2025-09-20 00:21:49 INFO  n.m.c.p.mock.CurrencyInitializer - Currency USD is ready to use.
2025-09-20 00:21:50 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Processando compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@357f5ef4
2025-09-20 00:21:50 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Criando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@357f5ef4
2025-09-20 00:21:50 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Armazenando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@662d42e
2025-09-20 00:21:50 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@25245f60
2025-09-20 00:21:50 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-20 00:21:50 DEBUG n.m.c.purchase.store.domain.Purchase - Salvando transação de compra
2025-09-20 00:21:50 DEBUG n.m.c.purchase.store.domain.Purchase - Transação de compra salva com sucesso: net.mycompany.commerce.purchase.model.PurchaseTransaction@668b9072
2025-09-20 00:21:50 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@c529ddd
2025-09-20 00:21:50 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-20 00:21:50 ERROR n.m.c.purchase.store.domain.Purchase - Moeda não encontrada no sistema: USD
2025-09-20 00:22:20 INFO  o.s.c.s.DefaultLifecycleProcessor - Shutdown phase 1073741823 ends with 1 bean still running after timeout of 30000ms: [applicationTaskExecutor]
2025-09-20 00:22:20 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-20 00:22:20 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-20 00:22:20 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-20 00:22:20 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-20 00:22:20 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-20 00:22:20 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
