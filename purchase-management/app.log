2025-09-19 21:57:49 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 15386 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 21:57:49 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 21:57:49 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 21:57:49 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 21:57:49 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 21:57:52 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 21:57:52 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 132 ms. Found 2 JPA repository interfaces.
2025-09-19 21:57:52 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 21:57:52 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 21:57:52 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=f5a41ce6-ccc2-393e-b78f-4ccd48cec2d9
2025-09-19 21:57:54 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 21:57:54 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 21:57:54 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 21:57:54 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 21:57:54 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4606 ms
2025-09-19 21:57:55 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 21:57:55 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 21:57:55 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 21:57:55 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 21:57:55 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 21:57:56 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 21:57:56 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 21:57:56 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 21:57:57 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 21:57:58 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 21:57:58 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 21:57:58 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 21:57:58 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 21:57:58 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 21:57:58 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 21:57:58 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'producerMock' defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/mock/ProducerMock.class]: Unsatisfied dependency expressed through constructor parameter 0: No qualifying bean of type 'net.mycompany.commerce.purchase.mock.QueueManagerServiceMock' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
2025-09-19 21:57:58 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 21:57:58 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 21:57:58 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 21:57:58 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 21:57:58 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-09-19 21:57:58 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-19 21:57:58 ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Parameter 0 of constructor in net.mycompany.commerce.purchase.mock.ProducerMock required a bean of type 'net.mycompany.commerce.purchase.mock.QueueManagerServiceMock' that could not be found.


Action:

Consider defining a bean of type 'net.mycompany.commerce.purchase.mock.QueueManagerServiceMock' in your configuration.

2025-09-19 21:59:10 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 15553 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 21:59:10 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 21:59:10 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 21:59:10 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 21:59:10 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 21:59:13 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 21:59:13 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 262 ms. Found 2 JPA repository interfaces.
2025-09-19 21:59:13 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 21:59:13 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 21:59:14 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=f5a41ce6-ccc2-393e-b78f-4ccd48cec2d9
2025-09-19 21:59:15 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 21:59:15 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 21:59:15 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 21:59:15 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 21:59:15 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5570 ms
2025-09-19 21:59:16 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 21:59:16 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 21:59:16 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 21:59:17 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 21:59:17 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 21:59:17 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 21:59:17 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 21:59:17 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 21:59:19 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 21:59:19 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 21:59:19 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 21:59:19 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 21:59:19 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 21:59:19 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 21:59:19 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 21:59:20 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 21:59:23 WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 9526f4e2-1b47-4e24-9746-f4067e1e228c

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-09-19 21:59:23 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-09-19 21:59:24 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 21:59:24 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 21:59:24 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 21:59:25 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 21:59:25 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 21:59:25 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 21:59:25 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 21:59:25 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 16.104 seconds (process running for 17.613)
2025-09-19 21:59:26 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-19 21:59:26 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-19 21:59:26 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 14 ms
2025-09-19 22:04:59 INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (1 addition, 0 deletions, 0 modifications)
2025-09-19 22:04:59 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:04:59 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:04:59 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:04:59 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:04:59 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:04:59 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:04:59 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:04:59 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:04:59 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:05:00 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 15553 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:05:00 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:05:00 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:05:01 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:05:01 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 2 JPA repository interfaces.
2025-09-19 22:05:01 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:05:01 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:05:01 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=f5a41ce6-ccc2-393e-b78f-4ccd48cec2d9
2025-09-19 22:05:01 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:05:01 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:05:01 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:05:01 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:05:01 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1497 ms
2025-09-19 22:05:02 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:05:02 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:05:02 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:05:02 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2025-09-19 22:05:02 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:05:02 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2025-09-19 22:05:02 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-2)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:05:02 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:05:02 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:05:02 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:05:02 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:05:02 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:05:02 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:05:02 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:05:02 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:05:03 WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 2ca76676-5580-418c-ac6a-ef0eb2116dfa

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-09-19 22:05:03 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-09-19 22:05:03 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:05:03 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:05:03 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:05:04 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:05:04 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:05:04 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:05:04 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:05:04 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 3.985 seconds (process running for 356.324)
2025-09-19 22:05:04 INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-09-19 22:05:16 INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2025-09-19 22:05:16 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:05:16 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:05:16 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:05:16 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:05:16 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:05:16 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:05:16 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:05:16 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown initiated...
2025-09-19 22:05:16 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown completed.
2025-09-19 22:05:16 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 15553 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:05:16 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:05:16 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:05:17 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:05:17 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 2 JPA repository interfaces.
2025-09-19 22:05:17 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:05:17 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:05:17 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=89a269e3-6262-3549-bfb5-4459666f8eee
2025-09-19 22:05:18 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:05:18 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:05:18 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:05:18 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:05:18 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1518 ms
2025-09-19 22:05:18 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:05:18 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:05:18 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:05:18 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Starting...
2025-09-19 22:05:18 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-3 - Added connection conn20: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:05:18 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Start completed.
2025-09-19 22:05:18 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-3)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:05:18 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:05:18 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:05:18 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:05:18 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:05:18 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:05:18 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:05:18 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:05:19 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:05:19 WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: c7b8be65-873c-4e45-89e5-f3a917e604a5

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-09-19 22:05:19 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-09-19 22:05:21 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:05:21 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:05:21 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:05:21 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:05:21 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:05:21 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:05:21 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:05:21 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 5.291 seconds (process running for 374.05)
2025-09-19 22:05:21 INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation delta:


==========================
CONDITION EVALUATION DELTA
==========================


Positive matches:
-----------------

    None


Negative matches:
-----------------

   ManagementWebSecurityAutoConfiguration:
      Did not match:
         - AllNestedConditions 1 matched 1 did not; NestedCondition on DefaultWebSecurityCondition.Beans @ConditionalOnMissingBean (types: org.springframework.security.web.SecurityFilterChain; SearchStrategy: all) found beans of type 'org.springframework.security.web.SecurityFilterChain' filterChain; NestedCondition on DefaultWebSecurityCondition.Classes @ConditionalOnClass found required classes 'org.springframework.security.web.SecurityFilterChain', 'org.springframework.security.config.annotation.web.builders.HttpSecurity' (DefaultWebSecurityCondition)
      Matched:
         - found 'session' scope (OnWebApplicationCondition)


Exclusions:
-----------

    None


Unconditional classes:
----------------------

    None



2025-09-19 22:05:32 INFO  o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application shutdown requested.
2025-09-19 22:05:32 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:05:32 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:05:32 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:05:32 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:05:32 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:05:32 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:05:32 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:05:32 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Shutdown initiated...
2025-09-19 22:05:32 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-3 - Shutdown completed.
2025-09-19 22:05:46 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 16090 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:05:46 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:05:46 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:05:46 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 22:05:46 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 22:05:49 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:05:49 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 154 ms. Found 2 JPA repository interfaces.
2025-09-19 22:05:49 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:05:49 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:05:50 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=89a269e3-6262-3549-bfb5-4459666f8eee
2025-09-19 22:05:52 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:05:52 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:05:52 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:05:52 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:05:52 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5768 ms
2025-09-19 22:05:53 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:05:53 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 22:05:53 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:05:54 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:05:54 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 22:05:54 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:05:54 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 22:05:54 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:05:56 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:05:56 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:05:56 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:05:56 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:05:56 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:05:56 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:05:56 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:05:57 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:05:57 WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 9e13c281-946c-47c9-9832-01df65e9edce

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-09-19 22:05:57 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name inMemoryUserDetailsManager
2025-09-19 22:06:01 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:06:01 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:06:01 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:06:02 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:06:02 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:06:02 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:06:02 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:06:02 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 17.036 seconds (process running for 18.66)
2025-09-19 22:06:03 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-19 22:06:03 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-19 22:06:03 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 6 ms
2025-09-19 22:07:39 INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2025-09-19 22:07:39 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:07:39 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:07:39 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:07:39 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:07:39 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:07:39 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:07:39 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:07:39 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:07:39 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:07:40 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 16090 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:07:40 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:07:40 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:07:41 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:07:41 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 29 ms. Found 2 JPA repository interfaces.
2025-09-19 22:07:41 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:07:41 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:07:41 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=36bd0d6c-ac63-3dc7-8049-e34640002574
2025-09-19 22:07:41 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:07:41 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:07:41 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:07:41 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:07:41 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1499 ms
2025-09-19 22:07:42 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:07:42 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:07:42 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:07:42 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2025-09-19 22:07:42 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:07:42 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2025-09-19 22:07:42 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-2)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:07:42 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:07:42 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:07:42 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:07:42 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:07:42 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:07:42 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:07:42 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:07:43 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:07:44 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:07:44 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-19 22:07:45 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:07:45 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:07:45 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:07:45 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:07:45 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:07:45 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:07:45 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 5.681 seconds (process running for 122.094)
2025-09-19 22:07:45 INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation delta:


==========================
CONDITION EVALUATION DELTA
==========================


Positive matches:
-----------------

    None


Negative matches:
-----------------

   SpringBootWebSecurityConfiguration.WebSecurityEnablerConfiguration:
      Did not match:
         - @ConditionalOnMissingBean (names: springSecurityFilterChain; SearchStrategy: all) found beans named springSecurityFilterChain (OnBeanCondition)
      Matched:
         - @ConditionalOnClass found required class 'org.springframework.security.config.annotation.web.configuration.EnableWebSecurity' (OnClassCondition)

   UserDetailsServiceAutoConfiguration:
      Did not match:
         - @ConditionalOnMissingBean (types: org.springframework.security.authentication.AuthenticationManager,org.springframework.security.authentication.AuthenticationProvider,org.springframework.security.core.userdetails.UserDetailsService,org.springframework.security.authentication.AuthenticationManagerResolver,?; SearchStrategy: all) found beans of type 'org.springframework.security.core.userdetails.UserDetailsService' userDetailsService (OnBeanCondition)
      Matched:
         - @ConditionalOnClass found required class 'org.springframework.security.authentication.AuthenticationManager' (OnClassCondition)
         - found 'session' scope (OnWebApplicationCondition)
         - AnyNestedCondition 1 matched 2 did not; NestedCondition on UserDetailsServiceAutoConfiguration.MissingAlternativeOrUserPropertiesConfigured.PasswordConfigured @ConditionalOnProperty (spring.security.user.password) did not find property 'spring.security.user.password'; NestedCondition on UserDetailsServiceAutoConfiguration.MissingAlternativeOrUserPropertiesConfigured.NameConfigured @ConditionalOnProperty (spring.security.user.name) did not find property 'spring.security.user.name'; NestedCondition on UserDetailsServiceAutoConfiguration.MissingAlternativeOrUserPropertiesConfigured.MissingAlternative @ConditionalOnMissingClass did not find unwanted classes 'org.springframework.security.oauth2.client.registration.ClientRegistrationRepository', 'org.springframework.security.oauth2.server.resource.introspection.OpaqueTokenIntrospector', 'org.springframework.security.saml2.provider.service.registration.RelyingPartyRegistrationRepository' (UserDetailsServiceAutoConfiguration.MissingAlternativeOrUserPropertiesConfigured)


Exclusions:
-----------

    None


Unconditional classes:
----------------------

    None



2025-09-19 22:07:55 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-19 22:07:55 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-19 22:07:55 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 8 ms
2025-09-19 22:08:15 INFO  o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application shutdown requested.
2025-09-19 22:08:15 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:08:15 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:08:15 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:08:15 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:08:15 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:08:15 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:08:15 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:08:15 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown initiated...
2025-09-19 22:08:15 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown completed.
2025-09-19 22:09:35 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 16514 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:09:35 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:09:35 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:09:35 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 22:09:35 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 22:09:38 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:09:39 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 259 ms. Found 2 JPA repository interfaces.
2025-09-19 22:09:39 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:09:39 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:09:39 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=36bd0d6c-ac63-3dc7-8049-e34640002574
2025-09-19 22:09:41 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:09:41 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:09:41 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:09:41 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:09:41 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5829 ms
2025-09-19 22:09:42 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:09:42 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 22:09:42 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:09:43 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:09:43 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 22:09:43 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:09:43 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 22:09:43 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:09:45 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:09:45 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:09:45 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:09:45 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:09:45 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:09:45 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:09:45 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:09:46 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:09:48 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:09:49 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-19 22:09:50 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:09:50 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:09:51 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:09:51 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:09:51 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:09:51 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:09:51 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 16.922 seconds (process running for 18.486)
2025-09-19 22:09:52 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-19 22:09:52 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-19 22:09:52 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 7 ms
2025-09-19 22:13:29 DEBUG n.m.c.purchase.mock.ProducerMock - Received purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@54b25e5e
2025-09-19 22:13:29 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@54b25e5e
2025-09-19 22:13:29 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-19 22:13:30 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 22:13:30 ERROR n.m.c.purchase.store.domain.Purchase - Moeda não encontrada no sistema: USD
2025-09-19 22:13:30 ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: java.lang.IllegalArgumentException: Currency not found: USD] with root cause
java.lang.IllegalArgumentException: Currency not found: USD
	at net.mycompany.commerce.purchase.store.domain.Purchase.newPurchase(Purchase.java:47)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
	at net.mycompany.commerce.purchase.store.domain.Purchase$$SpringCGLIB$$0.newPurchase(<generated>)
	at net.mycompany.commerce.purchase.mock.ProducerMock.enqueuePurchase(ProducerMock.java:48)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-09-19 22:13:47 INFO  o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application shutdown requested.
2025-09-19 22:13:47 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:13:47 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:13:47 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:13:47 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:13:47 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:13:47 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:13:47 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:13:47 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:13:47 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:16:22 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 17369 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:16:22 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:16:22 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:16:22 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 22:16:22 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 22:16:25 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:16:25 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 219 ms. Found 2 JPA repository interfaces.
2025-09-19 22:16:26 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:16:26 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:16:26 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d4256fd-29d4-3e1b-8c28-4e129222fe94
2025-09-19 22:16:28 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:16:28 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:16:28 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:16:28 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:16:28 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5818 ms
2025-09-19 22:16:29 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:16:29 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 22:16:29 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:16:30 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:16:30 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 22:16:30 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:16:30 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 22:16:30 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:16:32 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:16:32 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:16:32 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:16:32 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:16:32 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:16:32 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:16:32 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:16:33 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'purchaseConsumer' defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/store/consumer/PurchaseConsumer.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'purchaseConsumer': Requested bean is currently in creation: Is there an unresolvable circular reference or an asynchronous initialization dependency?
2025-09-19 22:16:33 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:16:33 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:16:33 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:16:33 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:16:33 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-09-19 22:16:33 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-19 22:16:33 ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

The dependencies of some of the beans in the application context form a cycle:

┌──->──┐
|  purchaseConsumer defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/store/consumer/PurchaseConsumer.class]
└──<-──┘


Action:

Relying upon circular references is discouraged and they are prohibited by default. Update your application to remove the dependency cycle between beans. As a last resort, it may be possible to break the cycle automatically by setting spring.main.allow-circular-references to true.

2025-09-19 22:19:03 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 17558 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:19:03 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:19:03 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:19:03 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 22:19:03 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 22:19:06 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:19:06 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 158 ms. Found 2 JPA repository interfaces.
2025-09-19 22:19:06 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:19:06 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:19:07 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d4256fd-29d4-3e1b-8c28-4e129222fe94
2025-09-19 22:19:09 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:19:09 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:19:09 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:19:09 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:19:09 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5284 ms
2025-09-19 22:19:10 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:19:10 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 22:19:10 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:19:10 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:19:10 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 22:19:11 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:19:11 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 22:19:11 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:19:12 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:19:12 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:19:12 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:19:12 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:19:12 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:19:12 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:19:12 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:19:13 INFO  n.m.c.p.s.consumer.PurchaseConsumer - Iniciando consumidor de mensagens de compra...
2025-09-19 22:19:13 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'purchaseConsumer': Invocation of init method failed
2025-09-19 22:19:13 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:19:13 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:19:13 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:19:13 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:19:13 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-09-19 22:19:14 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-19 22:19:14 ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

The dependencies of some of the beans in the application context form a cycle:

┌──->──┐
|  purchaseConsumer
└──<-──┘


Action:

Relying upon circular references is discouraged and they are prohibited by default. Update your application to remove the dependency cycle between beans. As a last resort, it may be possible to break the cycle automatically by setting spring.main.allow-circular-references to true.

2025-09-19 22:20:44 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 17703 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:20:44 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:20:44 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:20:44 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 22:20:44 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 22:20:47 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:20:47 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 225 ms. Found 2 JPA repository interfaces.
2025-09-19 22:20:48 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:20:48 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:20:48 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d4256fd-29d4-3e1b-8c28-4e129222fe94
2025-09-19 22:20:50 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:20:50 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:20:50 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:20:50 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:20:50 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5306 ms
2025-09-19 22:20:51 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:20:51 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 22:20:51 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:20:51 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:20:51 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 22:20:52 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:20:52 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 22:20:52 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:20:53 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:20:54 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:20:54 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:20:54 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:20:54 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:20:54 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:20:54 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:20:55 INFO  n.m.c.p.s.consumer.PurchaseConsumer - Iniciando consumidor de mensagens de compra...
2025-09-19 22:20:55 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'purchaseConsumer': Invocation of init method failed
2025-09-19 22:20:55 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:20:55 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:20:55 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:20:55 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:20:55 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-09-19 22:20:55 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-19 22:20:55 ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

The dependencies of some of the beans in the application context form a cycle:

┌──->──┐
|  purchaseConsumer
└──<-──┘


Action:

Relying upon circular references is discouraged and they are prohibited by default. Update your application to remove the dependency cycle between beans. As a last resort, it may be possible to break the cycle automatically by setting spring.main.allow-circular-references to true.

2025-09-19 22:24:00 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 18044 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:24:00 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:24:00 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:24:01 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 22:24:01 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 22:24:04 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:24:04 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 240 ms. Found 2 JPA repository interfaces.
2025-09-19 22:24:05 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:24:05 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:24:05 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d4256fd-29d4-3e1b-8c28-4e129222fe94
2025-09-19 22:24:07 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:24:07 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:24:07 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:24:07 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:24:07 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 6789 ms
2025-09-19 22:24:08 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:24:09 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 22:24:09 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:24:09 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:24:09 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 22:24:10 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:24:10 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 22:24:10 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:24:12 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:24:12 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:24:12 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:24:12 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:24:12 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:24:12 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:24:12 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:24:13 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:24:15 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:24:16 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-19 22:24:17 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:24:18 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:24:18 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:24:18 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:24:18 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:24:19 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:24:19 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-19 22:24:19 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 19.315 seconds (process running for 21.305)
2025-09-19 22:24:19 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-19 22:24:19 INFO  n.m.c.p.mock.CurrencyInitializer - Checking if default currency USD exists and creating it...
2025-09-19 22:24:19 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 22:24:19 DEBUG org.hibernate.SQL - insert into currency_tb (code,country,name,id) values (?,?,?,default)
2025-09-19 22:24:19 INFO  n.m.c.p.mock.CurrencyInitializer - Currency USD is ready to use.
2025-09-19 22:24:20 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-19 22:24:20 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-19 22:24:20 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 31 ms
2025-09-19 22:24:29 DEBUG n.m.c.purchase.mock.ProducerMock - Received purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@150c5ade
2025-09-19 22:24:29 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Enqueuing purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@150c5ade
2025-09-19 22:24:29 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Generated transactionId: d85ae057-a43c-4680-a87b-7a0c58587e5c
2025-09-19 22:24:29 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Purchase request enqueued with transactionId: d85ae057-a43c-4680-a87b-7a0c58587e5c
2025-09-19 22:24:29 DEBUG n.m.c.purchase.mock.ProducerMock - Enqueued purchase with transactionId: d85ae057-a43c-4680-a87b-7a0c58587e5c
2025-09-19 22:24:29 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Mensagem de compra recebida: Message[transactionId=d85ae057-a43c-4680-a87b-7a0c58587e5c, request=net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@150c5ade]
2025-09-19 22:24:29 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Processando compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@150c5ade
2025-09-19 22:24:29 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@150c5ade
2025-09-19 22:24:29 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-19 22:24:29 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 22:24:29 DEBUG n.m.c.purchase.store.domain.Purchase - Salvando transação de compra
2025-09-19 22:24:29 DEBUG org.hibernate.SQL - insert into purchase_transaction_tb (amount,currency_id,description,purchase_date,transaction_id,id) values (?,?,?,?,?,default)
2025-09-19 22:24:29 DEBUG n.m.c.purchase.store.domain.Purchase - Transação de compra salva com sucesso: net.mycompany.commerce.purchase.model.PurchaseTransaction@3c330e65
2025-09-19 22:24:29 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Criando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@150c5ade
2025-09-19 22:24:29 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Armazenando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@31800b89
2025-09-19 22:24:29 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Storing response for transactionId d85ae057-a43c-4680-a87b-7a0c58587e5c: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@31800b89
2025-09-19 22:24:29 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Mensagem de compra processada: Message[transactionId=d85ae057-a43c-4680-a87b-7a0c58587e5c, request=net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@150c5ade]
2025-09-19 22:24:29 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-19 22:24:29 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-19 22:27:50 ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: java.lang.IllegalArgumentException: Name for argument of type [java.util.UUID] not specified, and parameter name information not available via reflection. Ensure that the compiler uses the '-parameters' flag.] with root cause
java.lang.IllegalArgumentException: Name for argument of type [java.util.UUID] not specified, and parameter name information not available via reflection. Ensure that the compiler uses the '-parameters' flag.
	at org.springframework.web.method.annotation.AbstractNamedValueMethodArgumentResolver.updateNamedValueInfo(AbstractNamedValueMethodArgumentResolver.java:186)
	at org.springframework.web.method.annotation.AbstractNamedValueMethodArgumentResolver.getNamedValueInfo(AbstractNamedValueMethodArgumentResolver.java:161)
	at org.springframework.web.method.annotation.AbstractNamedValueMethodArgumentResolver.resolveArgument(AbstractNamedValueMethodArgumentResolver.java:107)
	at org.springframework.web.method.support.HandlerMethodArgumentResolverComposite.resolveArgument(HandlerMethodArgumentResolverComposite.java:122)
	at org.springframework.web.method.support.InvocableHandlerMethod.getMethodArgumentValues(InvocableHandlerMethod.java:227)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:181)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-09-19 22:31:11 INFO  o.s.b.d.a.LocalDevToolsAutoConfiguration$RestartingClassPathChangeChangedEventListener - Restarting due to 1 class path change (0 additions, 0 deletions, 1 modification)
2025-09-19 22:31:11 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:31:11 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:31:27 INFO  o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application shutdown requested.
2025-09-19 22:31:41 INFO  o.s.c.s.DefaultLifecycleProcessor - Shutdown phase 1073741823 ends with 1 bean still running after timeout of 30000ms: [applicationTaskExecutor]
2025-09-19 22:31:41 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:31:41 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:31:41 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:31:41 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:31:41 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:31:41 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:31:41 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:31:41 ERROR o.s.a.i.SimpleAsyncUncaughtExceptionHandler - Unexpected exception occurred invoking async method: public void net.mycompany.commerce.purchase.store.consumer.PurchaseConsumer.consumeMessages()
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'defaultValidator' defined in class path resource [org/springframework/boot/autoconfigure/validation/ValidationAutoConfiguration.class]: org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@213d531a has been closed already
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1826)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:607)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1760)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory$DependencyObjectProvider.getObject(DefaultListableBeanFactory.java:2502)
	at org.springframework.validation.beanvalidation.MethodValidationAdapter.invokeValidatorForReturnValue(MethodValidationAdapter.java:294)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:180)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:114)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.IllegalStateException: org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@213d531a has been closed already
	at org.springframework.context.support.AbstractApplicationContext.assertBeanFactoryActive(AbstractApplicationContext.java:1256)
	at org.springframework.context.support.GenericApplicationContext.getAutowireCapableBeanFactory(GenericApplicationContext.java:338)
	at org.springframework.validation.beanvalidation.LocalValidatorFactoryBean.afterPropertiesSet(LocalValidatorFactoryBean.java:297)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1873)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1822)
	... 17 common frames omitted
2025-09-19 22:31:42 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 18044 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:31:42 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:31:42 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:31:43 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:31:43 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 2 JPA repository interfaces.
2025-09-19 22:31:43 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:31:43 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:31:43 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d4256fd-29d4-3e1b-8c28-4e129222fe94
2025-09-19 22:31:43 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:31:43 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:31:43 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:31:43 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:31:43 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1560 ms
2025-09-19 22:31:44 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:31:44 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:31:44 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:31:44 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2025-09-19 22:31:44 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:31:44 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2025-09-19 22:31:44 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-2)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:31:44 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:31:44 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:31:44 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:31:44 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:31:44 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:31:44 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:31:44 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:31:45 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:31:46 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:31:46 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-19 22:31:48 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:31:48 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:31:48 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:31:48 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:31:48 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:31:48 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:31:48 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 6.788 seconds (process running for 471.072)
2025-09-19 22:31:48 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-19 22:31:48 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-19 22:31:48 INFO  o.s.b.d.a.ConditionEvaluationDeltaLoggingListener - Condition evaluation unchanged
2025-09-19 22:31:48 INFO  n.m.c.p.mock.CurrencyInitializer - Checking if default currency USD exists and creating it...
2025-09-19 22:31:48 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 22:31:49 DEBUG org.hibernate.SQL - insert into currency_tb (code,country,name,id) values (?,?,?,default)
2025-09-19 22:31:49 INFO  n.m.c.p.mock.CurrencyInitializer - Currency USD is ready to use.
2025-09-19 22:32:05 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 18455 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 22:32:05 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 22:32:05 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 22:32:05 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 22:32:05 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 22:32:08 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 22:32:09 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 205 ms. Found 2 JPA repository interfaces.
2025-09-19 22:32:09 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 22:32:09 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 22:32:09 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d4256fd-29d4-3e1b-8c28-4e129222fe94
2025-09-19 22:32:11 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 22:32:11 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 22:32:11 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 22:32:11 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 22:32:11 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5776 ms
2025-09-19 22:32:12 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 22:32:12 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 22:32:12 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 22:32:13 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 22:32:13 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 22:32:13 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 22:32:13 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 22:32:13 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 22:32:15 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 22:32:15 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 22:32:15 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id uuid not null, currency_id bigint not null, primary key (id))
2025-09-19 22:32:15 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 22:32:15 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 22:32:15 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 22:32:15 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:32:16 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 22:32:18 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 22:32:18 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-19 22:32:20 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 22:32:20 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 22:32:21 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:32:21 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 22:32:21 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 22:32:21 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 22:32:21 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-19 22:32:21 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-19 22:32:21 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 16.802 seconds (process running for 18.671)
2025-09-19 22:32:21 INFO  n.m.c.p.mock.CurrencyInitializer - Checking if default currency USD exists and creating it...
2025-09-19 22:32:21 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 22:32:21 DEBUG org.hibernate.SQL - insert into currency_tb (code,country,name,id) values (?,?,?,default)
2025-09-19 22:32:22 INFO  n.m.c.p.mock.CurrencyInitializer - Currency USD is ready to use.
2025-09-19 22:32:22 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-19 22:32:22 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-19 22:32:22 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 9 ms
2025-09-19 22:32:38 DEBUG n.m.c.purchase.mock.ProducerMock - Received purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@611e1401
2025-09-19 22:32:38 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Enqueuing purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@611e1401
2025-09-19 22:32:38 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Generated transactionId: 175387e3-400a-4dba-93d9-5422abdff3cd
2025-09-19 22:32:38 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Purchase request enqueued with transactionId: 175387e3-400a-4dba-93d9-5422abdff3cd
2025-09-19 22:32:38 DEBUG n.m.c.purchase.mock.ProducerMock - Enqueued purchase with transactionId: 175387e3-400a-4dba-93d9-5422abdff3cd
2025-09-19 22:32:38 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Mensagem de compra recebida: Message[transactionId=175387e3-400a-4dba-93d9-5422abdff3cd, request=net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@611e1401]
2025-09-19 22:32:38 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Processando compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@611e1401
2025-09-19 22:32:38 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@611e1401
2025-09-19 22:32:38 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-19 22:32:38 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 22:32:38 DEBUG n.m.c.purchase.store.domain.Purchase - Salvando transação de compra
2025-09-19 22:32:38 DEBUG org.hibernate.SQL - insert into purchase_transaction_tb (amount,currency_id,description,purchase_date,transaction_id,id) values (?,?,?,?,?,default)
2025-09-19 22:32:38 DEBUG n.m.c.purchase.store.domain.Purchase - Transação de compra salva com sucesso: net.mycompany.commerce.purchase.model.PurchaseTransaction@891866d
2025-09-19 22:32:38 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Criando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@611e1401
2025-09-19 22:32:38 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Armazenando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@60d2c46a
2025-09-19 22:32:38 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Storing response for transactionId 175387e3-400a-4dba-93d9-5422abdff3cd: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@60d2c46a
2025-09-19 22:32:38 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Mensagem de compra processada: Message[transactionId=175387e3-400a-4dba-93d9-5422abdff3cd, request=net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@611e1401]
2025-09-19 22:32:38 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-19 22:32:38 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-19 22:32:49 DEBUG n.m.c.purchase.mock.ProducerMock - Checking response for transactionId: 175387e3-400a-4dba-93d9-5422abdff3cd
2025-09-19 22:32:49 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Retrieving response for transactionId: 175387e3-400a-4dba-93d9-5422abdff3cd
2025-09-19 22:32:49 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId 175387e3-400a-4dba-93d9-5422abdff3cd: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@60d2c46a
2025-09-19 22:32:49 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId 175387e3-400a-4dba-93d9-5422abdff3cd is ready
2025-09-19 22:33:05 INFO  o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application shutdown requested.
2025-09-19 22:33:05 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 22:33:05 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 22:33:35 INFO  o.s.c.s.DefaultLifecycleProcessor - Shutdown phase 1073741823 ends with 1 bean still running after timeout of 30000ms: [applicationTaskExecutor]
2025-09-19 22:33:35 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 22:33:35 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 22:33:35 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 22:33:35 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 22:33:35 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 22:33:35 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 22:33:35 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 22:33:35 ERROR o.s.a.i.SimpleAsyncUncaughtExceptionHandler - Unexpected exception occurred invoking async method: public void net.mycompany.commerce.purchase.store.consumer.PurchaseConsumer.consumeMessages()
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'defaultValidator' defined in class path resource [org/springframework/boot/autoconfigure/validation/ValidationAutoConfiguration.class]: org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@23bd03df has been closed already
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1826)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:607)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1760)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory$DependencyObjectProvider.getObject(DefaultListableBeanFactory.java:2502)
	at org.springframework.validation.beanvalidation.MethodValidationAdapter.invokeValidatorForReturnValue(MethodValidationAdapter.java:294)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:180)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:114)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.IllegalStateException: org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@23bd03df has been closed already
	at org.springframework.context.support.AbstractApplicationContext.assertBeanFactoryActive(AbstractApplicationContext.java:1256)
	at org.springframework.context.support.GenericApplicationContext.getAutowireCapableBeanFactory(GenericApplicationContext.java:338)
	at org.springframework.validation.beanvalidation.LocalValidatorFactoryBean.afterPropertiesSet(LocalValidatorFactoryBean.java:297)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1873)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1822)
	... 17 common frames omitted
2025-09-19 23:18:47 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 21570 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 23:18:47 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 23:18:47 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 23:18:47 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 23:18:47 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 23:18:50 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 23:18:50 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 176 ms. Found 2 JPA repository interfaces.
2025-09-19 23:18:51 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 23:18:51 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 23:18:51 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=9e1975a5-0203-3f58-b52f-6c8556c9d254
2025-09-19 23:18:53 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 23:18:53 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 23:18:53 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 23:18:53 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 23:18:53 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5561 ms
2025-09-19 23:18:53 DEBUG n.m.c.p.errorhandler.TraceIdFilter - Filter 'traceIdFilter' configured for use
2025-09-19 23:18:54 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 23:18:54 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 23:18:54 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 23:18:54 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 23:18:54 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 23:18:55 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 23:18:55 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 23:18:55 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 23:18:57 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 23:18:57 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 23:18:57 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id varchar(255) not null, currency_id bigint not null, primary key (id))
2025-09-19 23:18:57 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 23:18:57 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 23:18:57 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 23:18:57 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 23:18:57 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'purchaseConsumer' defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/store/consumer/PurchaseConsumer.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'purchase' defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/store/domain/Purchase.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'purchaseTransactionRepository' defined in net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository defined in @EnableJpaRepositories declared on JpaRepositoriesRegistrar.EnableJpaRepositoriesConfiguration: Could not create query for public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Reason: Failed to create query for method public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Cannot compare left expression of type 'java.lang.String' with right expression of type 'java.util.UUID'
2025-09-19 23:18:57 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 23:18:57 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 23:18:57 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 23:18:57 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 23:18:57 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-09-19 23:18:58 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-19 23:18:58 ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'purchaseConsumer' defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/store/consumer/PurchaseConsumer.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'purchase' defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/store/domain/Purchase.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'purchaseTransactionRepository' defined in net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository defined in @EnableJpaRepositories declared on JpaRepositoriesRegistrar.EnableJpaRepositoriesConfiguration: Could not create query for public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Reason: Failed to create query for method public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Cannot compare left expression of type 'java.lang.String' with right expression of type 'java.util.UUID'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:804)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1395)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1232)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.instantiateSingleton(DefaultListableBeanFactory.java:1221)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingleton(DefaultListableBeanFactory.java:1187)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:1123)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:987)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:318)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350)
	at net.mycompany.commerce.purchase.PurchaseManagementApplication.main(PurchaseManagementApplication.java:15)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:50)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'purchase' defined in file [/home/edgard/git/commerce-purchase/purchase-management/bin/main/net/mycompany/commerce/purchase/store/domain/Purchase.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'purchaseTransactionRepository' defined in net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository defined in @EnableJpaRepositories declared on JpaRepositoriesRegistrar.EnableJpaRepositoriesConfiguration: Could not create query for public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Reason: Failed to create query for method public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Cannot compare left expression of type 'java.lang.String' with right expression of type 'java.util.UUID'
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:804)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1395)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1232)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1760)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1643)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:913)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791)
	... 24 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'purchaseTransactionRepository' defined in net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository defined in @EnableJpaRepositories declared on JpaRepositoriesRegistrar.EnableJpaRepositoriesConfiguration: Could not create query for public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Reason: Failed to create query for method public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Cannot compare left expression of type 'java.lang.String' with right expression of type 'java.util.UUID'
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1826)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:607)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1760)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1643)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:913)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791)
	... 38 common frames omitted
Caused by: org.springframework.data.repository.query.QueryCreationException: Could not create query for public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Reason: Failed to create query for method public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Cannot compare left expression of type 'java.lang.String' with right expression of type 'java.util.UUID'
	at org.springframework.data.repository.query.QueryCreationException.create(QueryCreationException.java:101)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.lookupQuery(QueryExecutorMethodInterceptor.java:120)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.mapMethodsToQuery(QueryExecutorMethodInterceptor.java:104)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.lambda$new$0(QueryExecutorMethodInterceptor.java:92)
	at java.base/java.util.Optional.map(Optional.java:260)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.<init>(QueryExecutorMethodInterceptor.java:92)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport.getRepository(RepositoryFactorySupport.java:434)
	at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.lambda$afterPropertiesSet$4(RepositoryFactoryBeanSupport.java:350)
	at org.springframework.data.util.Lazy.getNullable(Lazy.java:135)
	at org.springframework.data.util.Lazy.get(Lazy.java:113)
	at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.afterPropertiesSet(RepositoryFactoryBeanSupport.java:356)
	at org.springframework.data.jpa.repository.support.JpaRepositoryFactoryBean.afterPropertiesSet(JpaRepositoryFactoryBean.java:132)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1873)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1822)
	... 49 common frames omitted
Caused by: java.lang.IllegalArgumentException: Failed to create query for method public abstract java.util.Optional net.mycompany.commerce.purchase.repository.PurchaseTransactionRepository.findByTransactionId(java.util.UUID); Cannot compare left expression of type 'java.lang.String' with right expression of type 'java.util.UUID'
	at org.springframework.data.jpa.repository.query.PartTreeJpaQuery.<init>(PartTreeJpaQuery.java:107)
	at org.springframework.data.jpa.repository.query.JpaQueryLookupStrategy$CreateQueryLookupStrategy.resolveQuery(JpaQueryLookupStrategy.java:128)
	at org.springframework.data.jpa.repository.query.JpaQueryLookupStrategy$CreateIfNotFoundQueryLookupStrategy.resolveQuery(JpaQueryLookupStrategy.java:260)
	at org.springframework.data.jpa.repository.query.JpaQueryLookupStrategy$AbstractQueryLookupStrategy.resolveQuery(JpaQueryLookupStrategy.java:99)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.lookupQuery(QueryExecutorMethodInterceptor.java:116)
	... 61 common frames omitted
Caused by: org.hibernate.query.SemanticException: Cannot compare left expression of type 'java.lang.String' with right expression of type 'java.util.UUID'
	at org.hibernate.query.sqm.internal.TypecheckUtil.assertComparable(TypecheckUtil.java:406)
	at org.hibernate.query.sqm.tree.predicate.SqmComparisonPredicate.<init>(SqmComparisonPredicate.java:46)
	at org.hibernate.query.sqm.tree.predicate.SqmComparisonPredicate.<init>(SqmComparisonPredicate.java:32)
	at org.hibernate.query.sqm.internal.SqmCriteriaNodeBuilder.equal(SqmCriteriaNodeBuilder.java:2158)
	at org.hibernate.query.sqm.internal.SqmCriteriaNodeBuilder.equal(SqmCriteriaNodeBuilder.java:192)
	at org.springframework.data.jpa.repository.query.JpaQueryCreator$PredicateBuilder.build(JpaQueryCreator.java:319)
	at org.springframework.data.jpa.repository.query.JpaQueryCreator.toPredicate(JpaQueryCreator.java:211)
	at org.springframework.data.jpa.repository.query.JpaQueryCreator.create(JpaQueryCreator.java:122)
	at org.springframework.data.jpa.repository.query.JpaQueryCreator.create(JpaQueryCreator.java:1)
	at org.springframework.data.repository.query.parser.AbstractQueryCreator.createCriteria(AbstractQueryCreator.java:119)
	at org.springframework.data.repository.query.parser.AbstractQueryCreator.createQuery(AbstractQueryCreator.java:95)
	at org.springframework.data.repository.query.parser.AbstractQueryCreator.createQuery(AbstractQueryCreator.java:81)
	at org.springframework.data.jpa.repository.query.PartTreeJpaQuery$QueryPreparer.<init>(PartTreeJpaQuery.java:224)
	at org.springframework.data.jpa.repository.query.PartTreeJpaQuery$CountQueryPreparer.<init>(PartTreeJpaQuery.java:370)
	at org.springframework.data.jpa.repository.query.PartTreeJpaQuery.<init>(PartTreeJpaQuery.java:103)
	... 65 common frames omitted
2025-09-19 23:21:05 INFO  n.m.c.p.PurchaseManagementApplication - Starting PurchaseManagementApplication using Java 21.0.8 with PID 21782 (/home/edgard/git/commerce-purchase/purchase-management/bin/main started by edgard in /home/edgard/git/commerce-purchase/purchase-management)
2025-09-19 23:21:05 DEBUG n.m.c.p.PurchaseManagementApplication - Running with Spring Boot v3.5.6, Spring v6.2.11
2025-09-19 23:21:05 INFO  n.m.c.p.PurchaseManagementApplication - No active profile set, falling back to 1 default profile: "default"
2025-09-19 23:21:05 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-09-19 23:21:05 INFO  o.s.b.d.e.DevToolsPropertyDefaultsPostProcessor - For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-09-19 23:21:08 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-09-19 23:21:08 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 232 ms. Found 2 JPA repository interfaces.
2025-09-19 23:21:09 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'errorChannel' has been explicitly defined. Therefore, a default PublishSubscribeChannel will be created.
2025-09-19 23:21:09 INFO  o.s.i.c.DefaultConfiguringBeanFactoryPostProcessor - No bean named 'integrationHeaderChannelRegistry' has been explicitly defined. Therefore, a default DefaultHeaderChannelRegistry will be created.
2025-09-19 23:21:09 INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=9e1975a5-0203-3f58-b52f-6c8556c9d254
2025-09-19 23:21:11 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-09-19 23:21:11 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-09-19 23:21:11 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.46]
2025-09-19 23:21:11 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-09-19 23:21:11 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5581 ms
2025-09-19 23:21:12 DEBUG n.m.c.p.errorhandler.TraceIdFilter - Filter 'traceIdFilter' configured for use
2025-09-19 23:21:12 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-09-19 23:21:12 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.29.Final
2025-09-19 23:21:12 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-09-19 23:21:13 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-09-19 23:21:13 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-09-19 23:21:13 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:commerce-purchase user=SA
2025-09-19 23:21:13 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-09-19 23:21:13 INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 2.3.232
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
2025-09-19 23:21:15 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-09-19 23:21:15 DEBUG org.hibernate.SQL - create table currency_tb (id bigint generated by default as identity, code varchar(3) not null, country varchar(50) not null, name varchar(50) not null, primary key (id))
2025-09-19 23:21:15 DEBUG org.hibernate.SQL - create table purchase_transaction_tb (id bigint generated by default as identity, amount numeric(15,2) not null, description varchar(80), purchase_date timestamp(6) not null, transaction_id varchar(255) not null, currency_id bigint not null, primary key (id))
2025-09-19 23:21:15 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb drop constraint if exists UKfttmnjw755a8qy2nuuefmk03n
2025-09-19 23:21:15 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint UKfttmnjw755a8qy2nuuefmk03n unique (transaction_id)
2025-09-19 23:21:15 DEBUG org.hibernate.SQL - alter table if exists purchase_transaction_tb add constraint FK9od1oydumcmu61110o64lup3u foreign key (currency_id) references currency_tb
2025-09-19 23:21:15 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 23:21:16 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-09-19 23:21:18 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 1 endpoint beneath base path '/actuator'
2025-09-19 23:21:18 INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userDetailsService
2025-09-19 23:21:20 INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:commerce-purchase'
2025-09-19 23:21:20 INFO  o.s.b.d.a.OptionalLiveReloadServer - LiveReload server is running on port 35729
2025-09-19 23:21:21 INFO  o.s.i.endpoint.EventDrivenConsumer - Adding {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 23:21:21 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 1 subscriber(s).
2025-09-19 23:21:21 INFO  o.s.i.endpoint.EventDrivenConsumer - started bean '_org.springframework.integration.errorLogger'
2025-09-19 23:21:21 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/'
2025-09-19 23:21:21 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-19 23:21:21 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-19 23:21:21 INFO  n.m.c.p.PurchaseManagementApplication - Started PurchaseManagementApplication in 16.718 seconds (process running for 18.388)
2025-09-19 23:21:21 INFO  n.m.c.p.mock.CurrencyInitializer - Checking if default currency USD exists and creating it...
2025-09-19 23:21:21 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 23:21:21 DEBUG org.hibernate.SQL - insert into currency_tb (code,country,name,id) values (?,?,?,default)
2025-09-19 23:21:21 INFO  n.m.c.p.mock.CurrencyInitializer - Currency USD is ready to use.
2025-09-19 23:21:22 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-19 23:21:22 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-09-19 23:21:22 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 6 ms
2025-09-19 23:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Received purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@16996511
2025-09-19 23:21:33 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Enqueuing purchase request: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@16996511
2025-09-19 23:21:33 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Generated transactionId: n0sclQMnjr7Qels1
2025-09-19 23:21:33 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Purchase request enqueued with transactionId: n0sclQMnjr7Qels1
2025-09-19 23:21:33 DEBUG n.m.c.purchase.mock.ProducerMock - Enqueued purchase with transactionId: n0sclQMnjr7Qels1
2025-09-19 23:21:33 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Mensagem de compra recebida: Message[transactionId=n0sclQMnjr7Qels1, request=net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@16996511]
2025-09-19 23:21:33 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Processando compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@16996511
2025-09-19 23:21:33 DEBUG n.m.c.purchase.store.domain.Purchase - Processando nova compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@16996511
2025-09-19 23:21:33 DEBUG n.m.c.purchase.store.domain.Purchase - Usando moeda padrão do sistema: USD
2025-09-19 23:21:33 DEBUG org.hibernate.SQL - select c1_0.id,c1_0.code,c1_0.country,c1_0.name from currency_tb c1_0 where c1_0.code=?
2025-09-19 23:21:33 DEBUG n.m.c.purchase.store.domain.Purchase - Salvando transação de compra
2025-09-19 23:21:33 DEBUG org.hibernate.SQL - insert into purchase_transaction_tb (amount,currency_id,description,purchase_date,transaction_id,id) values (?,?,?,?,?,default)
2025-09-19 23:21:33 DEBUG n.m.c.purchase.store.domain.Purchase - Transação de compra salva com sucesso: net.mycompany.commerce.purchase.model.PurchaseTransaction@5054f405
2025-09-19 23:21:33 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Criando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@16996511
2025-09-19 23:21:33 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Armazenando resposta para a compra: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@624fe0f0
2025-09-19 23:21:33 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Storing response for transactionId n0sclQMnjr7Qels1: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@624fe0f0
2025-09-19 23:21:33 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Mensagem de compra processada: Message[transactionId=n0sclQMnjr7Qels1, request=net.mycompany.commerce.purchase.store.dto.StorePurchaseRequest@16996511]
2025-09-19 23:21:33 DEBUG n.m.c.p.s.consumer.PurchaseConsumer - Aguardando mensagem de compra...
2025-09-19 23:21:33 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Waiting to take a message from the queue...
2025-09-19 23:21:45 DEBUG n.m.c.purchase.mock.ProducerMock - Checking response for transactionId: n0sclQMnjr7Qels1
2025-09-19 23:21:45 DEBUG n.m.c.p.mock.QueueManagerServiceMock - Retrieving response for transactionId: n0sclQMnjr7Qels1
2025-09-19 23:21:45 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId n0sclQMnjr7Qels1: net.mycompany.commerce.purchase.store.dto.StorePurchaseResponse@624fe0f0
2025-09-19 23:21:45 DEBUG n.m.c.purchase.mock.ProducerMock - Response for transactionId n0sclQMnjr7Qels1 is ready
2025-09-19 23:21:59 INFO  o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application shutdown requested.
2025-09-19 23:21:59 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-19 23:21:59 INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-19 23:22:29 INFO  o.s.c.s.DefaultLifecycleProcessor - Shutdown phase 1073741823 ends with 1 bean still running after timeout of 30000ms: [applicationTaskExecutor]
2025-09-19 23:22:29 INFO  o.s.i.endpoint.EventDrivenConsumer - Removing {logging-channel-adapter:_org.springframework.integration.errorLogger} as a subscriber to the 'errorChannel' channel
2025-09-19 23:22:29 INFO  o.s.i.c.PublishSubscribeChannel - Channel 'purchase-management.errorChannel' has 0 subscriber(s).
2025-09-19 23:22:29 INFO  o.s.i.endpoint.EventDrivenConsumer - stopped bean '_org.springframework.integration.errorLogger'
2025-09-19 23:22:29 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-19 23:22:29 WARN  o.s.b.f.s.DisposableBeanAdapter - Invocation of destroy method failed on bean with name 'inMemoryDatabaseShutdownExecutor': org.h2.jdbc.JdbcSQLNonTransientConnectionException: Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-232]
2025-09-19 23:22:29 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-09-19 23:22:29 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-09-19 23:22:29 ERROR o.s.a.i.SimpleAsyncUncaughtExceptionHandler - Unexpected exception occurred invoking async method: public void net.mycompany.commerce.purchase.store.consumer.PurchaseConsumer.consumeMessages()
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'defaultValidator' defined in class path resource [org/springframework/boot/autoconfigure/validation/ValidationAutoConfiguration.class]: org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@1c0a3a21 has been closed already
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1826)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:607)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:373)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1760)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory$DependencyObjectProvider.getObject(DefaultListableBeanFactory.java:2502)
	at org.springframework.validation.beanvalidation.MethodValidationAdapter.invokeValidatorForReturnValue(MethodValidationAdapter.java:294)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:180)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:114)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.IllegalStateException: org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@1c0a3a21 has been closed already
	at org.springframework.context.support.AbstractApplicationContext.assertBeanFactoryActive(AbstractApplicationContext.java:1256)
	at org.springframework.context.support.GenericApplicationContext.getAutowireCapableBeanFactory(GenericApplicationContext.java:338)
	at org.springframework.validation.beanvalidation.LocalValidatorFactoryBean.afterPropertiesSet(LocalValidatorFactoryBean.java:297)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1873)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1822)
	... 17 common frames omitted
